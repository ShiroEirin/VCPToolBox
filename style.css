/* style.css */
@font-face {
    font-family: 'Maven Pro ExtraBold'; /* Corrected font name with space */
    src: url('./assets/font/MavenPro-ExtraBold.ttf') format('truetype');
    font-weight: 800;
    font-style: normal;
}

:root {
    /* --- 默认暗色主题 (墨色系) --- */
    --primary-bg-dark: #1c1c1e;      /* 深墨灰 - 近黑 */
    --secondary-bg-dark: #28282c;    /* 略浅的墨灰 */
    --tertiary-bg-dark: #121212;     /* 聊天区背景 - 纯黑に近い */
    --accent-bg-dark: #3a3a3e;       /* 悬停/选中背景 - 中墨灰 */
    --primary-text-dark: #e0e0e0;    /* 主要文字 - 浅灰 */
    --secondary-text-dark: #a0a0a0;  /* 次要/标题文字 - 中灰 */
    --highlight-text-dark: #6fa8dc;  /* 高亮文字 - 柔和蓝 (点缀色) */
    --border-color-dark: #3a3a3e;    /* 边框颜色 */
    --user-bubble-bg-dark: rgba(56, 120, 173, 0.75);  /* 用户气泡 - 柔和蓝 (点缀色) - 带透明度 */
    --assistant-bubble-bg-dark: rgba(47, 47, 51, 0.75);/* AI气泡 - 深墨灰 - 带透明度 */
    --button-bg-dark: #48484c;       /* 普通按钮背景 - 中墨灰 */
    --button-hover-bg-dark: #58585e; /* 按钮悬停 - 略亮的墨灰 */
    --danger-color-dark: #e57373;    /* 危险操作 - 柔和红 */
    --danger-hover-bg-dark: #ef5350; /* 危险操作悬停 - 略深的柔和红 */
    --input-bg-dark: #222225;        /* 输入框背景 */
    --tool-bubble-bg-dark: #3a3a3e;   /* VCP工具调用气泡背景 */
    --tool-bubble-border-dark: #58585e;
    --notification-bg-dark: #2f2f33;
    --notification-header-bg-dark: #3a3a3e;
    --notification-border-dark: #48484c;
    --scrollbar-track-dark: rgba(40, 40, 40, 0.5);
    --scrollbar-thumb-dark: rgba(100, 100, 100, 0.6);
    --scrollbar-thumb-hover-dark: rgba(120, 120, 120, 0.8);
    --quoted-text-dark: #FFB74D; /* 深色模式引用文本 - 柔和橙色 */

    /* --- 亮色主题 --- */
    --primary-bg-light: #f4f6f8;      /* 非常浅的灰蓝色 */
    --secondary-bg-light: #ffffff;    /* 白色 */
    --tertiary-bg-light: #e9edf0;     /* 聊天区背景，浅灰 */
    --accent-bg-light: #e0e6eb;       /* 悬停/选中背景 */
    --primary-text-light: #2c3e50;    /* 主要文字 - 深灰蓝 */
    --secondary-text-light: #5a6f80;  /* 次要/标题文字 - 中灰蓝 */
    --highlight-text-light: #3498db;  /* 高亮文字 - 清爽蓝 */
    --border-color-light: #e0e6eb;    /* 边框颜色 - 调整为更浅的颜色，与 accent-bg-light 相似 */
    --user-bubble-bg-light: rgba(52, 152, 219, 0.7);  /* 用户气泡 - 清爽蓝 - 带透明度 */
    --assistant-bubble-bg-light: rgba(232, 244, 248, 0.7);/* AI气泡 - 非常浅的蓝 - 带透明度 */
    --button-bg-light: #3498db;       /* 普通按钮背景 - 清爽蓝 */
    --button-hover-bg-light: #2980b9; /* 按钮悬停 - 深一点的蓝 */
    --danger-color-light: #e74c3c;    /* 危险操作 - 红色 */
    --danger-hover-bg-light: #c0392b; /* 危险操作悬停 - 深红 */
    --input-bg-light: #ffffff;        /* 输入框背景 - 白色 */
    --tool-bubble-bg-light: #e0e6eb;   /* VCP工具调用气泡背景 - 浅灰 */
    --tool-bubble-border-light: #b8c0c8;
    --notification-bg-light: #e8f4f8;
    --notification-header-bg-light: #d0d8e0;
    --notification-border-light: #3498db;
    --scrollbar-track-light: rgba(200, 200, 200, 0.5);
    --scrollbar-thumb-light: rgba(150, 150, 150, 0.6);
    --scrollbar-thumb-hover-light: rgba(120, 120, 120, 0.8);
    --quoted-text-light: #007bff; /* 浅色模式引用文本 - 蓝色 */

    /* --- 通用/当前主题变量 --- */
    /* 默认使用暗色主题变量 */
    --primary-bg: var(--primary-bg-dark);
    --secondary-bg: var(--secondary-bg-dark);
    --tertiary-bg: var(--tertiary-bg-dark);
    --accent-bg: var(--accent-bg-dark);
    --primary-text: var(--primary-text-dark);
    --secondary-text: var(--secondary-text-dark);
    --highlight-text: var(--highlight-text-dark);
    --border-color: var(--border-color-dark);
    --user-bubble-bg: var(--user-bubble-bg-dark);
    --assistant-bubble-bg: var(--assistant-bubble-bg-dark);
    --button-bg: var(--button-bg-dark);
    --button-hover-bg: var(--button-hover-bg-dark);
    --danger-color: var(--danger-color-dark);
    --danger-hover-bg: var(--danger-hover-bg-dark);
    --input-bg: var(--input-bg-dark);
    --tool-bubble-bg: var(--tool-bubble-bg-dark);
    --tool-bubble-border: var(--tool-bubble-border-dark);
    --notification-bg: var(--notification-bg-dark);
    --notification-header-bg: var(--notification-header-bg-dark);
    --notification-border: var(--notification-border-dark);
    --scrollbar-track: var(--scrollbar-track-dark);
    --scrollbar-thumb: var(--scrollbar-thumb-dark);
    --scrollbar-thumb-hover: var(--scrollbar-thumb-hover-dark);
    --quoted-text: var(--quoted-text-dark); /* 新增：引用文本颜色 */
}

/* --- 亮色主题应用 --- */
body.light-theme {
    --primary-bg: var(--primary-bg-light);
    --secondary-bg: var(--secondary-bg-light);
    --tertiary-bg: var(--tertiary-bg-light);
    --accent-bg: var(--accent-bg-light);
    --primary-text: var(--primary-text-light);
    --secondary-text: var(--secondary-text-light);
    --highlight-text: var(--highlight-text-light);
    --border-color: var(--border-color-light);
    --user-bubble-bg: var(--user-bubble-bg-light);
    --assistant-bubble-bg: var(--assistant-bubble-bg-light);
    --button-bg: var(--button-bg-light);
    --button-hover-bg: var(--button-hover-bg-light);
    --danger-color: var(--danger-color-light);
    --danger-hover-bg: var(--danger-hover-bg-light);
    --input-bg: var(--input-bg-light);
    --tool-bubble-bg: var(--tool-bubble-bg-light);
    --tool-bubble-border: var(--tool-bubble-border-light);
    --notification-bg: var(--notification-bg-light);
    --notification-header-bg: var(--notification-header-bg-light);
    --notification-border: var(--notification-border-light);
    --scrollbar-track: var(--scrollbar-track-light);
    --scrollbar-thumb: var(--scrollbar-thumb-light);
    --scrollbar-thumb-hover: var(--scrollbar-thumb-hover-light);
    --quoted-text: var(--quoted-text-light); /* 新增：引用文本颜色 */
}

body.light-theme .main-content {
    background-image: url('assets/light.jpeg');
}

body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
    margin: 0;
    padding: 0;
    background-color: var(--primary-bg);
    color: var(--primary-text);
    display: flex;
    flex-direction: column; /* Changed to column to stack title-bar and container */
    height: 100vh;
    overflow: hidden;
    font-size: 15px;
    -webkit-font-smoothing: antialiased; /* 提升字体渲染清晰度 */
    -moz-osx-font-smoothing: grayscale; /* 提升字体渲染清晰度 (Firefox) */
    text-rendering: optimizeLegibility; /* 优化文本渲染 */
}

/* --- Custom Title Bar --- */
.title-bar {
    height: 30px; /* Adjust as needed */
    background-color: var(--secondary-bg);
    color: var(--primary-text);
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 5px 0 10px; /* Reduced right padding slightly */
    border-bottom: 1px solid var(--border-color);
    -webkit-app-region: drag;
    flex-shrink: 0;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 1001;
    box-sizing: border-box; /* Added */
}

.title-bar-text {
    font-size: 0.9em;
    margin-left: 0px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    flex-grow: 1;
    min-width: 0; /* Allow shrinking */
    margin-right: 10px; /* Add some space between text and controls */
}

.title-bar-logo {
   height: 20px; /* Adjust based on title bar height */
   margin-right: 8px;
   vertical-align: middle; /* Align with text */
}

.title-bar-controls {
    display: flex;
    align-items: center;
    -webkit-app-region: no-drag;
    flex-shrink: 0; /* Crucial: Do not allow this container to shrink */
    height: 100%; /* Ensure controls container fills title bar height */
    min-width: 120px; /* Ensure enough space for 4 buttons (4 * 30px) */
    flex-wrap: nowrap; /* Force buttons to stay on one line */
}

.title-bar-button {
    background: transparent;
    border: none;
    color: var(--secondary-text);
    padding: 0;
    width: 30px; /* Standard width for window controls */
    height: 30px; /* Match title-bar height explicitly */
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.2s ease;
    box-sizing: border-box;
    flex-shrink: 0; /* Buttons themselves should not shrink */
}

.title-bar-button svg {
    width: 10px;
    height: 10px;
    fill: currentColor;
}

.title-bar-button:hover {
    background-color: var(--accent-bg);
    color: var(--highlight-text);
}

.title-bar-button.close-button:hover {
    background-color: var(--danger-color);
    color: white;
}


.container {
    display: flex;
    width: 100%;
    /* height: 100%; */ /* Original */
    height: calc(100vh - 30px); /* Adjust based on title-bar height */
    margin-top: 30px; /* Offset for the fixed title bar */
    overflow: hidden; /* Prevent scrollbars on body due to resizers */
}

/* --- Resizers --- */
.resizer {
    background-color: var(--border-color);
    width: 5px;
    cursor: col-resize;
    flex-shrink: 0;
    z-index: 100; /* 提高 z-index */
    opacity: 0.5;
    transition: opacity 0.2s ease, background-color 0.2s ease;
    pointer-events: auto; /* 确保能捕获鼠标事件 */
}
.resizer:hover {
    background-color: var(--user-bubble-bg);
    opacity: 1;
}


/* --- Sidebar (Agent List) --- */
.sidebar {
    width: 260px;
    min-width: 220px;
    background-color: var(--secondary-bg);
    padding: 15px;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    border-right: 1px solid var(--border-color);
    transition: width 0.2s ease-in-out;
    overflow-x: hidden; /* 禁止侧边栏本身的横向滚动条 */
}
 
/* Sidebar Tabs */
.sidebar-tabs {
    display: flex;
    margin-bottom: 15px;
    border-bottom: 1px solid var(--border-color);
}

.sidebar-tab-button {
    flex-grow: 1;
    padding: 10px 5px;
    background-color: transparent;
    border: none;
    border-bottom: 2px solid transparent; /* For active indicator */
    color: var(--secondary-text);
    cursor: pointer;
    font-size: 0.95em;
    text-align: center;
    transition: background-color 0.2s ease, color 0.2s ease, border-bottom-color 0.2s ease;
    margin-bottom: -1px; /* Align with bottom border of container */
}

.sidebar-tab-button:hover {
    background-color: var(--accent-bg);
    color: var(--highlight-text);
}

.sidebar-tab-button.active {
    color: var(--highlight-text);
    border-bottom-color: var(--user-bubble-bg);
    font-weight: 500;
}

.sidebar-tab-content {
    display: flex;
    flex-direction: column;
    flex-grow: 1;
    opacity: 0;
    max-height: 0;
    overflow: hidden;
    transform: translateY(10px);
    pointer-events: none;
    transition: opacity 0.25s ease-out,
                transform 0.25s ease-out,
                max-height 0.35s cubic-bezier(0.25, 0.1, 0.25, 1);
}

.sidebar-tab-content.active {
    opacity: 1;
    max-height: 100vh; /* Adjust if sidebar has a more constrained max height. */
    transform: translateY(0);
    overflow-y: auto;
    pointer-events: auto;
    overflow-x: hidden;
}
/* End Sidebar Tabs */

.sidebar h2 {
    color: var(--secondary-text);
    margin-top: 5px;
    margin-bottom: 15px;
    /* text-align: center; */ /* 将由新的 settings-header-bar 控制 */
    font-size: 1.4em;
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 10px;
}

/* 新增：设置标签页内的标题栏 */
.settings-header-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px; /* 与原 h2 margin-bottom 一致 */
    padding-bottom: 10px; /* 与原 h2 padding-bottom 一致 */
    border-bottom: 1px solid var(--border-color); /* 与原 h2 border-bottom 一致 */
}

.settings-header-bar h2 {
    margin: 0; /* 移除 h2 自带的 margin */
    padding: 0; /* 移除 h2 自带的 padding */
    border-bottom: none; /* 边框移到父元素 */
    text-align: left; /* 标题居左 */
    flex-grow: 1; /* 让标题占据多余空间，将按钮推到右边 */
}

.settings-header-bar .global-settings-btn {
    width: auto; /* 不再是全宽 */
    padding: 8px 15px; /* 调整按钮内边距使其不那么大 */
    font-size: 0.9em; /* 调整字体大小 */
    margin-left: 15px; /* 与标题保持一些间距 */
}

/* Styling for both Agent List and Topic List items */
.agent-list, .topic-list {
    list-style-type: none;
    padding: 0;
    margin: 0;
    overflow-y: auto;
    overflow-x: hidden; /* 禁止列表本身的横向滚动条 */
    flex-grow: 1;
}
 
.agent-list li, .topic-list .topic-item {
    padding: 10px 12px;
    margin-bottom: 6px;
    border-radius: 8px; /* 统一圆角 */
    cursor: pointer;
    display: flex;
    align-items: center;
    transition: background-color 0.2s ease, transform 0.1s ease;
}

.agent-list li:hover, .topic-list .topic-item:hover {
    background-color: var(--accent-bg);
    transform: translateX(2px);
}
.agent-list li.active { /* Specific to agent list active state */
    background-color: var(--user-bubble-bg);
    color: white;
    font-weight: 500;
}
.agent-list li.active .agent-name {
    color: white;
}
.agent-list li.active img.avatar {
    border-color: var(--highlight-text);
}

/* Shared styles for avatar and name in both lists */
.agent-list img.avatar, .topic-list .topic-item img.avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    margin-right: 10px;
    object-fit: cover;
    border: 2px solid var(--button-bg);
}

.agent-list .agent-name, .topic-list .topic-item .agent-name {
    font-weight: 400;
    font-size: 1.05em;
    color: var(--primary-text);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    flex-grow: 1; /* Allow name to take available space */
}

/* Specific to Topic List */
.topic-list .topic-item {
    /* Inherits most styles from .agent-list li */
}

.topic-list .topic-item .message-count {
    margin-left: auto; /* Pushes count to the right */
    padding: 3px 8px;
    background-color: var(--accent-bg);
    color: var(--highlight-text);
    border-radius: 10px;
    font-size: 0.85em; /* 略微增大字体 */
    min-width: 20px; /* Ensure some width even for single digit */
    text-align: center;
    font-weight: bold; /* 加粗 */
    font-family: "Arial Rounded MT Bold", "Helvetica Rounded", Arial, sans-serif; /* 尝试圆润字体 */
}

#tabContentTopics p { /* Style for loading/empty messages in topics tab */
    padding: 15px;
    text-align: center;
    color: var(--secondary-text);
}


.sidebar-actions {
    margin-top: auto;
    padding-top: 10px;
    border-top: 1px solid var(--border-color);
    display: flex;
    flex-direction: column;
    gap: 8px;
}
.sidebar-button {
    background-color: var(--button-bg);
    color: var(--primary-text);
    border: 1px solid transparent; /* 添加边框以便亮色模式下更清晰 */
    padding: 10px;
    width: 100%;
    border-radius: 8px; /* 统一圆角 */
    cursor: pointer;
    font-size: 0.95em;
    transition: background-color 0.2s ease;
    text-align: center;
}
.sidebar-button:hover {
    background-color: var(--button-hover-bg);
    border-color: var(--button-hover-bg);
}

body.light-theme .sidebar-button {
    color: #ffffff; /* 亮色主题下按钮文字用白色 */
    border: 1px solid var(--button-bg);
}

body.light-theme .sidebar-button:hover {
    color: #ffffff;
    border-color: var(--button-hover-bg);
}

/* --- Main Content (Chat Area) --- */
.main-content {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    background-color: var(--tertiary-bg); /* Fallback color */
    background-image: url('assets/dark.jpg');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
}

.chat-header {
    padding: 12px 20px;
    background-color: var(--secondary-bg);
    border-bottom: 1px solid var(--border-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
    min-height: 36px; /* Consistent height */
}
.chat-header h3 {
    margin: 0;
    font-size: 1.2em;
    color: var(--highlight-text);
    font-weight: 500;
}
.chat-actions .header-button {
    background: transparent;
    border: 1px solid var(--button-bg);
    color: var(--secondary-text);
    padding: 0 10px; /* 调整内边距，左右10px，上下由高度决定 */
    height: 32px; /* 设置统一高度 */
    border-radius: 8px; /* 统一圆角 */
    cursor: pointer;
    margin-left: 8px; /* 调整间距 */
    font-size: 0.9em;
    transition: background-color 0.2s, border-color 0.2s;
    display: inline-flex; /* 使用flex布局进行内部对齐 */
    align-items: center; /* 垂直居中 */
    justify-content: center; /* 水平居中 */
    box-sizing: border-box; /* 确保padding和border在高度内 */
}
/* 为只有图标的按钮调整一下padding，使其看起来更方正 */
.chat-actions .header-button#themeToggleBtn {
    padding: 0 8px; /* 稍微减少左右padding */
}
.chat-actions .header-button:hover {
    background-color: var(--button-hover-bg); /* 使用按钮悬停背景色 */
    border-color: var(--button-hover-bg);
    color: var(--primary-text); /* 悬停时文字颜色可能需要调整 */
}

body.light-theme .chat-actions .header-button {
    color: var(--button-bg);
}
body.light-theme .chat-actions .header-button:hover {
    color: #ffffff;
}


.chat-messages-container {
    flex-grow: 1;
    overflow-y: auto; /* Important for scrolling messages */
    display: flex; /* Allows messages to stack from bottom if needed */
    flex-direction: column-reverse; /* New messages appear at bottom and scroll up */
}

.chat-messages {
    padding: 15px 20px;
    display: flex;
    flex-direction: column; /* Messages stack vertically */
}

.message-item {
    margin-bottom: 10px;
    padding: 8px 12px;
    border-radius: 10px; /* 调整气泡圆角 */
    max-width: 60%;
    word-wrap: break-word;
    line-height: 1.5;
    box-shadow: 0 1px 2px rgba(0,0,0,0.15);
    position: relative; /* Needed for absolute positioning of controls inside */
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px); /* For Safari */
}

.message-controls {
    position: absolute;
    top: 2px;
    right: 5px;
    display: none; /* Hidden by default, shown on hover or context menu trigger */
    z-index: 10;
}

.message-item:hover .message-controls {
    display: flex; /* Show on hover for quick access, context menu is alternative */
}

.message-edit-btn {
    background: rgba(255,255,255,0.1);
    border: none;
    color: var(--primary-text);
    padding: 3px 6px; /* 调整padding */
    font-size: 0.8em;
    border-radius: 5px; /* 调整圆角 */
    cursor: pointer;
    margin-left: 5px;
}
.message-edit-btn:hover {
    background: rgba(255,255,255,0.2);
}


.message-item.user {
    background-color: var(--user-bubble-bg);
    color: var(--primary-text);
    align-self: flex-end;
    margin-left: auto;
    border-bottom-right-radius: 4px; /* 调整尾巴效果 */
}
body.light-theme .message-item.user {
    background-color: var(--user-bubble-bg-light);
    color: #ffffff; /* 用户气泡在亮色主题下文字用白色 */
}

.message-item.assistant {
    background-color: var(--assistant-bubble-bg);
    color: var(--primary-text);
    align-self: flex-start;
    margin-right: auto;
    border-bottom-left-radius: 4px; /* 调整尾巴效果 */
}
body.light-theme .message-item.assistant {
    background-color: var(--assistant-bubble-bg-light);
    color: var(--primary-text-light); /* AI气泡在亮色主题下文字用深色 */
    border: 1px solid #d0d8e0; /* 给AI气泡一个浅色边框 */
}
.message-item .sender-name { /* Less prominent sender name */
    font-weight: 500;
    margin-bottom: 3px;
    font-size: 0.85em;
    color: var(--secondary-text);
    opacity: 0.8;
}
.message-item img, .message-item video, .message-item audio {
    max-width: 100%;
    border-radius: 8px;
    margin-top: 8px;
    display: block;
}
.message-item pre { /* For code blocks within messages */
    background-color: rgba(0,0,0,0.2);
    padding: 10px;
    border-radius: 6px;
    overflow-x: auto;
    font-size: 0.9em;
    margin-top: 8px;
    border: 1px solid var(--border-color);
}

/* --- 话题创建时间戳气泡 --- */
.topic-timestamp-bubble {
    display: none; /* 默认隐藏，由JS控制显示 */
    text-align: center;
    padding: 3px 12px; /* 细长的感觉 */
    font-size: 0.75em; /* 较小的字体 */
    color: var(--secondary-text);
    background-color: var(--accent-bg); /* 使用强调背景色 */
    border-radius: 12px; /* 圆角使其像胶囊 */
    margin: 6px auto 8px auto; /* 上方与header间距，下方与聊天内容间距，左右自动居中 */
    max-width: fit-content; /* 宽度适应内容 */
    box-shadow: 0 1px 2px rgba(0,0,0,0.1); /* 轻微阴影 */
    opacity: 0.8; /* 略微透明 */
}


/* VCP Tool Request Bubble */
.vcp-tool-request-bubble {
    background-color: var(--tool-bubble-bg);
    border: 1px solid var(--tool-bubble-border);
    border-radius: 8px;
    padding: 10px 15px;
    margin-top: 10px;
    font-family: 'Consolas', 'Monaco', monospace;
    font-size: 0.9em;
    color: #c5c8c6; /* Light gray for code-like text */
    white-space: pre-wrap; /* Preserve formatting */
    box-shadow: 0 1px 3px rgba(0,0,0,0.2);
}
.vcp-tool-request-bubble strong { /* For tool_name: */
    color: #81a2be; /* Light blue for keywords */
}
.vcp-tool-request-bubble span.vcp-param-value { /* For 「始」value「末」 */
    color: #b5bd68; /* Light green for values */
}


.chat-input-area {
    padding-top: 8px; /* Reduced top padding for the entire input area */
    padding-right: 15px;
    padding-bottom: 12px; /* Kept bottom padding same */
    padding-left: 15px;
    background-color: var(--secondary-bg);
    border-top: 1px solid var(--border-color);
    display: flex;
    align-items: flex-end; /* Align items to bottom for multi-line textarea */
    flex-wrap: wrap; /* Allow items to wrap */
}
/* .attachment-preview-area specific styles are defined around line 1295 */
/* The old .attachment-preview-area style at line 627 will be overridden or removed by the more specific one if it targets the same ID/class */
.attachment-preview-area .file-preview {
    background-color: var(--accent-bg);
    padding: 3px 6px;
    border-radius: 4px;
    font-size: 0.8em;
    display: flex;
    align-items: center;
}
.attachment-preview-area .file-preview button {
    background: none;
    border: none;
    color: var(--danger-color);
    margin-left: 5px;
    cursor: pointer;
    padding: 0;
    font-size: 1.1em;
}


#messageInput {
    flex-grow: 1;
    padding-top: 8px; /* Reduced top padding */
    padding-right: 12px;
    padding-bottom: 10px;
    padding-left: 12px;
    border: 1px solid var(--border-color);
    border-radius: 20px; /* 统一圆角，使其更圆润 */
    background-color: var(--input-bg);
    color: var(--primary-text);
    font-size: 1em;
    resize: none; /* Prevent manual resize, JS will handle height */
    margin-right: 10px;
    max-height: 150px; /* Limit max height */
    overflow-y: auto;
    line-height: 1.4;
}
#messageInput:focus {
    outline: none;
    border-color: var(--user-bubble-bg);
    box-shadow: 0 0 0 2px rgba(61, 90, 128, 0.3);
}

#sendMessageBtn, #attachFileBtn {
    background-color: var(--button-bg); /* 使用统一的按钮背景色 */
    border: none;
    border-radius: 50%; /* 保持圆形 */
    width: 40px;
    height: 40px;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    transition: background-color 0.2s ease;
    padding: 0;
    margin-left: 8px;
}
#sendMessageBtn svg, #attachFileBtn svg {
    fill: var(--primary-text); /* 图标颜色 */
}
body.light-theme #sendMessageBtn svg, body.light-theme #attachFileBtn svg {
    fill: #ffffff; /* 亮色主题下图标用白色 */
}

#sendMessageBtn:hover, #attachFileBtn:hover {
    background-color: var(--button-hover-bg);
}

/* --- Notifications Sidebar --- */
.notifications-sidebar {
    width: 300px;
    min-width: 250px;
    background-color: var(--secondary-bg);
    border-left: 1px solid var(--border-color);
    display: flex;
    flex-direction: column;
    padding: 0; /* Header will have padding */
}
.notifications-header {
    padding: 10px 15px; /* Adjusted padding */
    background-color: var(--accent-bg);
    display: flex;
    justify-content: space-between; /* Puts datetime-container to left, button to right */
    align-items: center;
    border-bottom: 1px solid var(--border-color);
}

/* Removed .notifications-header h4 style as it's hidden */

.datetime-container {
    display: flex;
    flex-direction: column;
    align-items: flex-start; /* Align text to the left */
}

#clearNotificationsBtn {
    background: transparent;
    border: 1px solid var(--button-bg);
    color: var(--secondary-text);
    font-size: 0.8em;
    padding: 4px 8px;
    border-radius: 6px; /* 统一圆角 */
    cursor: pointer;
}
#clearNotificationsBtn:hover {
    background-color: var(--button-hover-bg);
    color: var(--primary-text);
}
body.light-theme #clearNotificationsBtn {
    color: var(--button-bg);
}
body.light-theme #clearNotificationsBtn:hover {
    color: #ffffff;
}

.notifications-status {
    padding: 8px 15px;
    font-size: 0.85em;
    background-color: var(--tertiary-bg);
    color: var(--secondary-text);
    border-bottom: 1px solid var(--border-color);
    text-align: center;
}
.notifications-status.status-open { background-color: #2e7d32; color: white;}
.notifications-status.status-closed { background-color: #c62828; color: white;}
.notifications-status.status-error { background-color: #b71c1c; color: white;}
.notifications-status.status-connecting { background-color: #f9a825; color: black;}


.notifications-list {
    list-style-type: none;
    padding: 0;
    margin: 0;
    overflow-y: auto;
    flex-grow: 1;
}
.notification-item {
    padding: 10px 15px;
    border-bottom: 1px solid var(--border-color);
    font-size: 0.9em;
    background-color: var(--notification-bg);
    color: var(--primary-text); /* 确保文字颜色 */
}
.notification-item:last-child {
    border-bottom: none;
}
.notification-item strong {
    color: var(--highlight-text);
    display: block;
    margin-bottom: 4px;
}
.notification-item pre { /* For JSON data in notifications */
    background-color: rgba(0,0,0,0.2);
    padding: 6px;
    border-radius: 4px;
    font-size: 0.85em;
    margin-top: 5px;
    max-height: 100px;
    overflow: auto;
    white-space: pre-wrap;
    word-break: break-all;
}
.notification-timestamp {
    font-size: 0.75em;
    color: var(--secondary-text);
    opacity: 0.7;
    display: block;
    text-align: right;
    margin-top: 5px;
}


/* --- Modals --- */
.modal {
    display: none; /* Hidden by default */
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.6);
    align-items: center;
    justify-content: center;
}
.modal.active {
    display: flex;
}

.modal-content {
    background-color: var(--secondary-bg);
    margin: auto;
    padding: 25px 30px;
    border: 1px solid var(--border-color);
    border-radius: 12px; /* 统一圆角 */
    width: 90%;
    max-width: 550px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    position: relative;
    color: var(--primary-text);
}
.modal-content h2 {
    margin-top: 0;
    color: var(--highlight-text);
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 10px;
    margin-bottom: 20px;
}
.modal-content label {
    display: block;
    margin-bottom: 6px;
    font-weight: 500;
    color: var(--secondary-text);
}
.modal-content input[type="text"],
.modal-content input[type="url"],
.modal-content input[type="password"],
.modal-content input[type="number"],
.modal-content textarea,
.modal-content select {
    width: calc(100% - 20px);
    padding: 10px;
    margin-bottom: 15px;
    border-radius: 8px; /* 统一圆角 */
    border: 1px solid var(--border-color);
    background-color: var(--input-bg);
    color: var(--primary-text);
    font-size: 1em;
}
.modal-content input[type="file"] {
    margin-bottom: 15px;
}
.modal-content textarea {
    min-height: 80px;
    resize: vertical;
}
.modal-content button[type="submit"], .modal-content .danger-button {
    background-color: var(--user-bubble-bg);
    color: #ffffff; /* 确保文字是白色 */
    padding: 10px 18px;
    border: none;
    border-radius: 8px; /* 统一圆角 */
    cursor: pointer;
    font-size: 1em;
    transition: background-color 0.2s;
    margin-right: 10px;
}
.modal-content button[type="submit"]:hover {
    background-color: var(--button-hover-bg);
}
body.light-theme .modal-content button[type="submit"] {
    color: #ffffff;
}

.modal-content .danger-button {
    background-color: var(--danger-color);
    color: #ffffff; /* 确保危险按钮文字是白色 */
}
.modal-content .danger-button:hover {
    background-color: var(--danger-hover-bg);
}
body.light-theme .modal-content .danger-button {
    color: #ffffff;
}
.form-actions {
    margin-top: 20px;
    display: flex;
    justify-content: flex-end;
}


.close-button {
    color: #aaa;
    position: absolute;
    top: 0px;
    right: 8px;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
}
.close-button:hover,
.close-button:focus {
    color: var(--highlight-text);
    text-decoration: none;
}

/* Scrollbar styling */
::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}
::-webkit-scrollbar-track {
    background: var(--scrollbar-track);
    border-radius: 4px;
}
::-webkit-scrollbar-thumb {
    background: var(--scrollbar-thumb);
    border-radius: 4px;
}
::-webkit-scrollbar-thumb:hover {
    background: var(--scrollbar-thumb-hover);
}

/* Markdown specific styling for chat messages */
.message-item .md-content p { margin: 0 0 0.5em 0; }
.message-item .md-content h1, .message-item .md-content h2, .message-item .md-content h3 { margin-top: 0.8em; margin-bottom: 0.4em; color: var(--highlight-text); }
.message-item .md-content ul, .message-item .md-content ol { margin-left: 20px; padding-left: 0; }
.message-item .md-content blockquote { border-left: 3px solid var(--user-bubble-bg); margin-left: 0; padding-left: 1em; color: var(--secondary-text); }
.message-item .md-content code { background-color: rgba(0,0,0,0.2); padding: 0.2em 0.4em; border-radius: 3px; font-size: 0.9em; }
.message-item .md-content pre code { padding: 0; background: none; } /* Reset for code inside pre */

/* Styles for Message Editing */
.message-edit-textarea {
    width: calc(100% - 10px); /* Full width within the bubble, minus padding */
    min-height: 50px;
    padding: 8px;
    margin-top: 5px;
    margin-bottom: 5px;
    border: 1px solid var(--border-color);
    border-radius: 6px;
    background-color: var(--input-bg);
    color: var(--primary-text);
    font-family: inherit;
    font-size: 0.95em;
    resize: both; /* 修改: 允许双向调整大小 */
    box-sizing: border-box;
}

.message-edit-controls {
    display: flex;
    justify-content: flex-end;
    gap: 8px;
    margin-top: 5px;
}
.message-edit-controls button {
    padding: 5px 10px;
    border-radius: 4px;
    border: none;
    cursor: pointer;
    font-size: 0.9em;
    background-color: var(--button-bg);
    color: var(--primary-text); /* 确保文字颜色 */
    transition: background-color 0.2s ease;
}
.message-edit-controls button:hover {
    background-color: var(--button-hover-bg);
}
body.light-theme .message-edit-controls button {
    color: #ffffff; /* 亮色主题下按钮文字用白色 */
}


/* Context Menu Styling */
.context-menu {
    position: fixed;
    background-color: var(--secondary-bg);
    border: 1px solid var(--border-color);
    border-radius: 5px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    padding: 5px 0;
    z-index: 1001; /* Above modals if any, but below system UI */
    min-width: 150px;
}
.context-menu-item {
    padding: 8px 15px;
    color: var(--primary-text);
    cursor: pointer;
    font-size: 0.9em;
}
.context-menu-item:hover {
    background-color: var(--accent-bg);
    color: var(--highlight-text);
}
.context-menu-item.danger-text {
    color: var(--danger-color);
}
.context-menu-item.danger-text:hover {
    background-color: var(--danger-hover-bg);
    color: white; /* Or a lighter shade of red for hover text */
}


/* Mobile Responsiveness (Basic Example) */
@media (max-width: 768px) {
    .sidebar {
        width: 100%;
        height: auto;
        border-right: none;
        border-bottom: 1px solid var(--border-color);
        position: absolute; /* Or handle with JS toggle */
        z-index: 100;
        transform: translateX(-100%); /* Initially hidden */
        transition: transform 0.3s ease-in-out;
    }
    .sidebar.open {
        transform: translateX(0);
    }
    .main-content {
        width: 100%;
    }
    .notifications-sidebar {
        display: none; /* Simpler to hide on mobile, or make it a toggleable panel */
    }
    .message-item {
        max-width: 90%;
    }
    .modal-content {
        width: 95%;
        padding: 20px;
    }
    /* Add a menu button to toggle sidebar on mobile */
}

/* Styles for Agent Settings within the Tab Content */
#tabContentSettings {
    /* It's already display: flex; flex-direction: column; flex-grow: 1; overflow-y: auto; */
    /* Adding some padding to the tab content area for better spacing */
    padding: 15px;
    box-sizing: border-box;
}

#agentSettingsContainer {
    width: 100%;
    box-sizing: border-box;
    /* overflow-y: auto; /* If the form itself becomes too long */
    /* max-height: calc(100% - 80px); /* Example: Adjust if header/footer in tabContentSettings take space */
}

#agentSettingsContainer h3 { /* Style for "助手设置: AgentName" title */
    color: var(--highlight-text);
    margin-top: 0;
    margin-bottom: 15px;
    font-size: 1.2em;
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 8px;
}


#agentSettingsForm {
    width: 100%;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    gap: 12px; /* Space between form groups */
}

#agentSettingsForm > div { /* Direct div children of the form (label/input groups) */
    display: flex;
    flex-direction: column; /* Stack label on top of input */
    gap: 6px; /* Space between label and input */
}

#agentSettingsForm label {
    /* Styles from modal were: display: block; margin-bottom: 6px; font-weight: 500; color: var(--secondary-text); */
    /* Re-applying similar styles, adjusting margin as gap is now used */
    display: block;
    font-weight: 500;
    color: var(--secondary-text);
    font-size: 0.9em;
}

#agentSettingsForm input[type="text"],
#agentSettingsForm input[type="url"],
#agentSettingsForm input[type="password"],
#agentSettingsForm input[type="number"],
#agentSettingsForm input[type="file"],
#agentSettingsForm textarea,
#agentSettingsForm select {
    width: 100%;
    box-sizing: border-box;
    padding: 9px 10px;
    margin-bottom: 0; /* Gap is handled by parent flex */
    border-radius: 8px; /* 统一圆角 */
    border: 1px solid var(--border-color);
    background-color: var(--input-bg);
    color: var(--primary-text);
    font-size: 0.95em;
}
#agentSettingsForm input[type="file"] {
    padding: 5px; /* File input often needs different padding */
}


#agentSettingsForm textarea {
    min-height: 80px;
    resize: vertical;
}

#agentSettingsForm .form-actions {
    /* Styles from modal: margin-top: 20px; display: flex; justify-content: flex-end; */
    margin-top: 15px; /* Adjust spacing */
    display: flex;
    justify-content: flex-start; /* Align buttons to the start or use space-between */
    gap: 10px;
}

#agentSettingsForm .form-actions button {
    padding: 10px 18px; /* 与 modal 按钮一致 */
    font-size: 1em;    /* 与 modal 按钮一致 */
    border-radius: 8px; /* 与 modal 按钮一致 */
    border: none;       /* 与 modal 按钮一致 */
    cursor: pointer;    /* 与 modal 按钮一致 */
    transition: background-color 0.2s; /* 与 modal 按钮一致 */
    color: #ffffff; /* 确保文字默认是白色 */
}

#agentSettingsForm .form-actions button[type="submit"] {
    background-color: var(--user-bubble-bg); /* 使用 user-bubble-bg 作为主操作按钮颜色 */
}
#agentSettingsForm .form-actions button[type="submit"]:hover {
    background-color: var(--button-hover-bg);
}

#agentSettingsForm .form-actions .danger-button {
    background-color: var(--danger-color);
}
#agentSettingsForm .form-actions .danger-button:hover {
    background-color: var(--danger-hover-bg);
}

/* 确保 agentSettingsForm 中的按钮也应用亮色主题颜色 */
/* 亮色主题下，按钮背景色已通过变量切换，文字颜色保持白色 */
body.light-theme #agentSettingsForm .form-actions button[type="submit"] {
    background-color: var(--user-bubble-bg-light); /* 明确指定亮色主题下的背景 */
}
body.light-theme #agentSettingsForm .form-actions button[type="submit"]:hover {
    background-color: var(--button-hover-bg-light);
}
body.light-theme #agentSettingsForm .form-actions .danger-button {
    background-color: var(--danger-color-light); /* 明确指定亮色主题下的背景 */
}
body.light-theme #agentSettingsForm .form-actions .danger-button:hover {
    background-color: var(--danger-hover-bg-light);
}

#selectAgentPromptForSettings { /* The "Please select an agent" prompt */
    text-align: center;
    padding: 20px;
    color: var(--secondary-text);
}

/* --- Keyframes for animations (from userscript) --- */
@keyframes vcp-shimmer-bg {
    0% { background-position: 150% 0; } /* Start shimmer off-screen to the right */
    100% { background-position: -150% 0; } /* End shimmer off-screen to the left */
}

/* --- Enhanced Notification Item Styles --- */
.notification-item { /* Re-styling existing .notification-item to match original screenshot style */
    position: relative; /* For positioning the copy button */
    background-color: var(--notification-bg); /* Use existing theme variable */
    color: var(--primary-text); /* 确保文字颜色 */
    padding: 10px 15px; /* Original padding */
    padding-right: 40px; /* Make slightly more space for the copy button */
    border-bottom: 1px solid var(--border-color); /* Separator line */
    border-radius: 0; /* No rounded corners, or a very small value like 2px if subtle rounding is okay */
    margin: 0; /* No margin between items, they stack directly */
    font-size: 0.9em;
    box-shadow: none; /* Original screenshot doesn't show prominent shadow per item */
    opacity: 0; /* Start hidden for animation */
    transform: translateX(100%); /* Start off-screen for animation */
    transition: opacity 0.5s ease, transform 0.5s ease;
    width: 100%; /* Take full width of the parent list */
    box-sizing: border-box;
    cursor: pointer; /* To allow manual dismissal */
    overflow: hidden; /* Important for containing bg animations */

    /* Animated Shimmer Background */
    background-image: linear-gradient(
        110deg,
        var(--notification-bg) 0%, /* Base color from theme */
        var(--notification-bg) 40%,
        var(--accent-bg) 50%,    /* Shimmer highlight using accent color */
        var(--notification-bg) 60%,
        var(--notification-bg) 100% /* Base color from theme */
    );
    background-size: 250% 100%; /* Make gradient wider than element for sweep effect */
    animation: vcp-shimmer-bg 7s linear infinite; /* Slower shimmer */
}

.notification-item.visible { /* Class to trigger animation */
    opacity: 1;
    transform: translateX(0);
}

.notification-item:last-child {
    border-bottom: 1px solid var(--border-color); /* Keep border for last item if margin is used */
}
/* Override for when it's the actual last one in the list without margin issues */
.notifications-list > .notification-item:last-of-type {
   /* border-bottom: none; /* If no margin, then no border for the very last */
}

.notification-item strong { /* Title style */
    color: var(--highlight-text); /* Use existing theme variable */
    display: block;
    margin-bottom: 4px;
    position: relative; /* Ensure text is above the background animation */
    z-index: 1;
}

.notification-item .notification-content { /* Container for main text */
    position: relative;
    z-index: 1;
}

.notification-item pre { /* For JSON data or preformatted content in notifications */
    background-color: rgba(0,0,0,0.2); /* Consistent with existing pre style */
    padding: 6px;
    border-radius: 4px;
    font-size: 0.85em;
    margin-top: 5px;
    max-height: 100px;
    overflow: auto;
    white-space: pre-wrap;
    word-break: break-all;
    position: relative; /* Ensure text is above the background animation */
    z-index: 1;
}

.notification-copy-btn {
    position: absolute;
    top: 5px;
    right: 5px;
    background: rgba(255,255,255,0.1);
    color: var(--primary-text); /* 确保复制按钮文字颜色 */
    border: 1px solid rgba(255,255,255,0.3);
    border-radius: 4px;
    padding: 2px 5px;
    font-size: 0.8em;
    cursor: pointer;
    opacity: 0.7;
    transition: opacity 0.2s, background-color 0.2s;
    z-index: 2; /* Ensure copy button is above the background animation and content */
}
.notification-copy-btn:hover {
    opacity: 1;
    background: rgba(255,255,255,0.2);
}

/* Adjust timestamp to be part of the flow, or position it differently if needed */
.notification-timestamp {
    font-size: 0.75em;
    color: #444444; /* 更深的颜色，确保在浅色背景下清晰可见 */
    opacity: 0.9; /* 提高不透明度 */
    display: block;
    text-align: right;
    margin-top: 5px;
    position: relative;
    z-index: 1;
}

/* 确保亮色主题下通知项的文字清晰可见 */
body.light-theme .notification-item {
    color: #000000; /* 纯黑色，确保在浅色背景下清晰可见 */
}

/* --- 重新生成回复选项的样式 --- */
.context-menu-item.regenerate-text {
    color: #28a745; /* 绿色 */
    /* 确保亮色模式下颜色也可见 */
}

.context-menu-item.regenerate-text:hover {
    color: #1e7e34; /* 深绿色 on hover */
    background-color: var(--accent-bg); /* 保持与其他选项一致的悬停背景色 */
}

/* --- 附件预览区域美化 --- */
.attachment-preview-area {
    display: flex;
    flex-wrap: wrap; /* 允许换行 */
    gap: 8px; /* 附件之间的间距 */
    /* padding: 8px 0; */ /* 上下留出一些空间 */
    width: 100%; /* Take full width to occupy the first "row" */
    order: -1; /* Ensure it's visually the first item in the flex container */
    margin-bottom: 8px; /* Space below the preview area and above the input row */
    /* padding-bottom: 8px; */ /* Optional: if items inside need bottom padding */
}

.attachment-preview-item {
    background-color: var(--accent-bg); /* 使用主题的强调色作为背景 */
    color: var(--primary-text); /* 使用主题的主要文字颜色 */
    border-radius: 16px; /* 更圆润的胶囊形状 */
    padding: 2px 6px; /* 进一步减小内边距 */
    display: flex;
    align-items: center;
    font-size: 0.9em;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    transition: all 0.2s ease-in-out;
    cursor: default; /* 默认光标 */
    position: relative; /* 为内部的绝对定位元素提供参考 */
}

.attachment-preview-item:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 6px rgba(0,0,0,0.15);
}

.file-preview-icon {
    margin-right: 4px;
    font-size: 0.9em; /* 图标稍大一些 */
}

.file-preview-name {
    display: none; /* 隐藏文件名 */
}

.file-preview-remove-btn {
    position: absolute; /* 绝对定位 */
    top: -8px; /* 向上移动 */
    right: -8px; /* 向右移动 */
    background: transparent; /* 透明背景 */
    border: none;
    color: var(--danger-color); /* 使用危险颜色 */
    margin: 0; /* 移除外边距 */
    padding: 0; /* 移除内边距 */
    cursor: pointer;
    font-size: 1.2em; /* 增大 "x" 的大小 */
    line-height: 1;
    border-radius: 50%; /* 圆形按钮 */
    width: 20px; /* 固定宽度 */
    height: 20px; /* 固定高度 */
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.2s ease, color 0.2s ease;
    z-index: 10; /* 确保在气泡上方 */
}

.file-preview-remove-btn:hover {
    background-color: var(--danger-hover-bg); /* 悬停时使用危险颜色背景 */
    color: white; /* 悬停时文字变白 */
}
/* 确保旧的 .file-preview 样式不会冲突，或者可以考虑移除旧的 .file-preview 相关CSS */
.attachment-preview-area .file-preview { /* 如果还存在旧的 .file-preview 元素 */
    display: none; /* 隐藏旧的样式，如果新的 attachment-preview-item 完全替代了它 */
}

/* --- 聊天气泡内图片附件缩略图样式 --- */
.message-attachment-image-thumbnail {
    max-width: 150px; /* 限制最大宽度 */
    max-height: 150px; /* 限制最大高度 */
    border-radius: 8px; /* 圆角 */
    cursor: pointer; /* 点击手势 */
    object-fit: cover; /* 保持图片比例并填充 */
    margin: 5px; /* 与其他附件或文本的间距 */
    border: 1px solid var(--border-color); /* 边框，使用主题颜色 */
    transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
}

.message-attachment-image-thumbnail:hover {
    transform: scale(1.05); /* 轻微放大效果 */
    box-shadow: 0 2px 8px rgba(0,0,0,0.2); /* 悬停时添加阴影 */
}

/* 确保附件容器内的元素能正确排列 */
.message-attachments {
    display: flex;
    flex-wrap: wrap; /* 允许换行 */
    gap: 8px; /* 附件之间的间距 */
    margin-top: 8px;
}

/* --- Topic Search Bar Styling --- */
.topics-header {
    display: flex;
    flex-direction: column; /* Stack title and search bar */
    padding-bottom: 10px;
    border-bottom: 1px solid var(--border-color);
    margin-bottom: 15px;
}

.topics-header h2 {
    margin-top: 5px;
    margin-bottom: 10px; /* Space between title and search bar */
    color: var(--secondary-text);
    font-size: 1.4em;
    border-bottom: none; /* Remove border from h2 as parent now has it */
    padding-bottom: 0;
}

.topic-search-container {
    display: flex;
    width: 100%;
    gap: 8px; /* Space between input and button */
    padding: 0 15px; /* 与侧边栏左右内边距保持一致 */
    box-sizing: border-box; /* 确保padding包含在宽度内 */
}

.topic-search-input {
    flex-grow: 1;
    padding: 10px 12px;
    border: 1px solid var(--border-color);
    border-radius: 20px; /* Rounded corners */
    background-color: var(--input-bg);
    color: var(--primary-text);
    font-size: 1em;
    box-sizing: border-box; /* Include padding and border in the element's total width and height */
    max-width: calc(100% - 8px); /* 限制最大宽度，减去gap */
    min-width: 0; /* 允许缩小 */
}

.topic-search-input::placeholder {
    color: var(--secondary-text);
    opacity: 0.7;
}

.topic-search-input:focus {
    outline: none;
    border-color: var(--user-bubble-bg);
    box-shadow: 0 0 0 2px rgba(61, 90, 128, 0.3);
}

/* .topic-search-button styles removed as the button is no longer in use */

/* --- Digital Clock Styles --- */
.digital-clock {
    font-size: 2.0em; /* Reduced font size */
    color: var(--highlight-text);
    font-family: 'Maven Pro ExtraBold', 'Arial Black', sans-serif;
    font-weight: 800;
    letter-spacing: 1px;
    line-height: 1;
    margin-bottom: -1px; /* Adjusted for new font size */
    text-align: left;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
}

.date-display {
    font-size: 0.7em; /* Reduced font size for date */
    color: var(--secondary-text);
    font-weight: 500;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    line-height: 1;
    text-align: left;
    margin-top: 0px;
    position: relative;
    top: -1px;
    left: 3px;           /* Increased left value to move date further right */
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

@keyframes blinkColon {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.2; } /* Or 0 for full blink */
}

.digital-clock .colon {
    animation: blinkColon 2s infinite; /* Changed duration to 2 seconds */
    position: relative;
    /* top: -0.05em; */
}

/* .notifications-header adjustments are now at the top of this diff block */

/* --- 引号内文本样式 --- */
.message-item .md-content .quoted-text {
    color: var(--quoted-text);
    /* font-style: italic; */ /* 可选：如果需要斜体 */
}
/* --- Active Topic Glow Effect --- */
@keyframes st-colon-blink { /* This seems unrelated to the ripple, but was provided. Keeping it. */
    0%, 100% { opacity: 1; }
    50% { opacity: 0.2; }
}

@keyframes st-soft-circular-ripple-effect {
    0% {
        transform: translate(-50%, -50%) scale(0);
        opacity: 0.7; /* Start a bit more visible to see the initial soft color */
    }
    80% { /* Ripple expands and fades, hold opacity a bit longer before full fade */
        transform: translate(-50%, -50%) scale(18); /* Slightly larger scale for a wider soft ripple */
        opacity: 0;
    }
    100% {
        transform: translate(-50%, -50%) scale(0); /* Reset for next loop */
        opacity: 0;
    }
}

.topic-item.active-topic-glowing {
    position: relative; /* Ensure positioning context for the pseudo-element */
    overflow: hidden;   /* Contain the ripple effect */
}

.topic-item.active-topic-glowing::before {
    content: '';
    position: absolute;
    left: 50%;
    top: 50%;
    width: 10px; /* Initial size of the ripple's source */
    height: 10px;
    /* Using a radial gradient for a soft edge */
    background-image: radial-gradient(
        circle,
        rgba(190, 210, 240, 0.45) 0%, /* Center color - slightly more opaque */
        rgba(190, 210, 240, 0.3) 40%, /* Mid color */
        rgba(190, 210, 240, 0) 70%   /* Edge color - fully transparent */
    );
    border-radius: 50%;
    transform: translate(-50%, -50%) scale(0); /* Initial state: centered and scaled down */
    opacity: 0; /* Start transparent, animation will handle fade-in */
    animation: st-soft-circular-ripple-effect 3.8s ease-out infinite; /* Slightly adjusted timing */
    z-index: 0; /* Behind the content */
    pointer-events: none; /* So it doesn't interfere with clicks */
}
/* --- Active Topic Glow Effect (Light Theme Override) --- */
body.light-theme .topic-item.active-topic-glowing::before {
    background-image: radial-gradient(
        circle,
        rgba(65, 144, 213, 0.041) 0%,  /* Center color - deeper blue, increased opacity */
        rgba(56, 131, 196, 0.358) 40%, /* Mid color - deeper blue */
        rgba(14, 78, 134, 0) 70%   /* Edge color - fully transparent */
    ) !important;
}
/* --- End Active Topic Glow Effect --- */